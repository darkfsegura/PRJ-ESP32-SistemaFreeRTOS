<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PRJ-ARDUINO-SENSORES: /home/fsegura/FESQ/SYNC_MEGA/00FESQ_SHARED/0_EC-ESP32/CODES/L10/1-PRJ-SystemX-V1/src/main.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PRJ-ARDUINO-SENSORES
   </div>
   <div id="projectbrief">Proyecto Agrosavia Fontagro - Monitoreo con ESP32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">/home/fsegura/FESQ/SYNC_MEGA/00FESQ_SHARED/0_EC-ESP32/CODES/L10/1-PRJ-SystemX-V1/src/main.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>Sistema de logging multinivel con filtrado por modo de despliegue.</p>
<p>Sistema de logging multinivel con filtrado por modo de despliegue </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">level</td><td>Nivel de severidad del mensaje </td></tr>
    <tr><td class="paramname">message</td><td>Mensaje a registrar </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Si DEBUG_MODE == false → solo se imprimen INFO, WARNING, ERROR, TXDATA, TIMING</li>
<li>Si DEBUG_MODE == true → se imprimen todos los niveles</li>
</ul>
</dd></dl>
<div class="fragment"><div class="line"><a id="a0" name="a0"></a><a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a id="a1" name="a1"></a><a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Sistema inicializado correctamente&quot;</span>);</div>
<div class="line"><a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a id="a2" name="a2"></a><a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a0593585da9181e972974c1274d8f2b4f">DEBUG</a>, <span class="stringliteral">&quot;Variable interna: &quot;</span> + String(valor));</div>
<div class="ttc" id="amain_8cpp_html_a32abad09d9f828a9805862e18ad5da5f"><div class="ttname"><a href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a></div><div class="ttdeci">void log(LogLevel level, const String &amp;message)</div><div class="ttdoc">Sistema de logging.</div><div class="ttdef"><b>Definition</b> main.cpp:194</div></div>
<div class="ttc" id="amain_8cpp_html_aca1fd1d8935433e6ba2e3918214e07f9a0593585da9181e972974c1274d8f2b4f"><div class="ttname"><a href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a0593585da9181e972974c1274d8f2b4f">DEBUG</a></div><div class="ttdeci">@ DEBUG</div><div class="ttdoc">Mensajes de depuración detallados (solo DEBUG_MODE)</div><div class="ttdef"><b>Definition</b> main.cpp:86</div></div>
<div class="ttc" id="amain_8cpp_html_aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806"><div class="ttname"><a href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a></div><div class="ttdeci">@ INFO</div><div class="ttdoc">Información general del sistema.</div><div class="ttdef"><b>Definition</b> main.cpp:87</div></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * ESP32 BASIC EXAMPLE</span></div>
<div class="line"><span class="comment"> * Academic License – Non-Commercial, Attribution Required</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2025 Fredy Segura-Quijano, Universidad de los Andes</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Permission is granted to use, copy, modify, and redistribute this software </span></div>
<div class="line"><span class="comment"> * for non-commercial academic purposes, provided that proper attribution is given </span></div>
<div class="line"><span class="comment"> * to the original author. </span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Commercial use is prohibited without prior written permission.</span></div>
<div class="line"><span class="comment"> * This software is provided &quot;as is&quot;, without warranty of any kind.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Attribution requirement:</span></div>
<div class="line"><span class="comment"> * Cite &quot;Fredy Segura-Quijano, Universidad de los Andes, 2025&quot; in any work </span></div>
<div class="line"><span class="comment"> * (publication, presentation, or software) using this code, and indicate </span></div>
<div class="line"><span class="comment"> * any modifications made.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Contact: fsegura@uniandes.edu.co</span></div>
<div class="line"><span class="comment"> * Repository: github.com/fsegura</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;Arduino.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"><span class="comment">// CONFIGURACIÓN DEL SISTEMA</span></div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DEBUG_MODE true</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define COLA_TAMANO 5</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define TIEMPO_MUESTREO_TEMP 2000</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define TIEMPO_MUESTREO_HUM 3000</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define TIEMPO_PROCESAMIENTO_COLA 4000</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"><span class="comment">// DEFINICIÓN DE TIPOS DE DATOS</span></div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> <a class="code hl_enumeration" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9">LogLevel</a> {</div>
<div class="line">    <a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a0593585da9181e972974c1274d8f2b4f">DEBUG</a>,      </div>
<div class="line">    <a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>,       </div>
<div class="line">    <a id="a3" name="a3"></a><a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a984de77c680eaff141ec910e25568a81">WARNING</a>,    </div>
<div class="line">    <a id="a4" name="a4"></a><a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a2fd6f336d08340583bd620a7f5694c90">ERROR</a>      </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a id="_a5" name="_a5"></a><a class="code hl_struct" href="structDatosSensor.html">DatosSensor</a> {</div>
<div class="line">    <span class="keywordtype">float</span> <a id="a6" name="a6"></a><a class="code hl_variable" href="structDatosSensor.html#a611f4f290b184e14b1b3ca076734ed35">temp</a>;         </div>
<div class="line">    <span class="keywordtype">float</span> <a id="a7" name="a7"></a><a class="code hl_variable" href="structDatosSensor.html#a8d083dbc43e4b9a357f7fdd254942578">hum</a>;          </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a id="a8" name="a8"></a><a class="code hl_variable" href="structDatosSensor.html#aa4c9ab56e967437b601d0f64a6091cc0">timestamp</a>; </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"><span class="comment">// VARIABLES GLOBALES DEL SISTEMA</span></div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">float</span> <a id="a9" name="a9"></a><a class="code hl_variable" href="main_8cpp.html#aa68e0fc8577f270a5009b9eaf46d14d0">temperatura</a> = 0.0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">float</span> <a id="a10" name="a10"></a><a class="code hl_variable" href="main_8cpp.html#ab394a2325331757de6eae71b16c435e9">humedad</a> = 0.0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> <a id="a11" name="a11"></a><a class="code hl_variable" href="main_8cpp.html#a2c7fe780b692c078c449752cb090fc6e">temp_actualizada</a> = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> <a id="a12" name="a12"></a><a class="code hl_variable" href="main_8cpp.html#a50d54178b84b42fb8a9ab1e0acaa8cac">hum_actualizada</a> = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"><span class="comment">// OBJETOS FreeRTOS</span></div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"> </div>
<div class="line">SemaphoreHandle_t <a id="a13" name="a13"></a><a class="code hl_variable" href="main_8cpp.html#a89b891091e9e003d0eab8f6a4ced7dcf">xMutex</a>;</div>
<div class="line"> </div>
<div class="line">SemaphoreHandle_t <a id="a14" name="a14"></a><a class="code hl_variable" href="main_8cpp.html#a6f655f04d910fcd6e502bb161804986a">xSemaphoreEnvio</a>;</div>
<div class="line"> </div>
<div class="line">QueueHandle_t <a id="a15" name="a15"></a><a class="code hl_variable" href="main_8cpp.html#aa790f7161e459ab25c4a12b7385b4d15">xColaDatos</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"><span class="comment">// PROTOTIPOS DE FUNCIONES</span></div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Declaración de tareas FreeRTOS</span></div>
<div class="line"><span class="keywordtype">void</span> <a id="a16" name="a16"></a><a class="code hl_function" href="main_8cpp.html#af7236328716099c5a8377996b87ffd0d">TaskTemperatura</a>(<span class="keywordtype">void</span> *pvParameters);     </div>
<div class="line"><span class="keywordtype">void</span> <a id="a17" name="a17"></a><a class="code hl_function" href="main_8cpp.html#a951d8aa1e4fad228585e8cc12e93d85f">TaskHumedad</a>(<span class="keywordtype">void</span> *pvParameters);         </div>
<div class="line"><span class="keywordtype">void</span> <a id="a18" name="a18"></a><a class="code hl_function" href="main_8cpp.html#a0a20810e0b755938a26f4bdb9c73a01e">TaskEnviar</a>(<span class="keywordtype">void</span> *pvParameters);          </div>
<div class="line"><span class="keywordtype">void</span> <a id="a19" name="a19"></a><a class="code hl_function" href="main_8cpp.html#af48162eef8344edea5030479f116635f">TaskProcesarCola</a>(<span class="keywordtype">void</span> *pvParameters);    </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Funciones auxiliares</span></div>
<div class="line"><span class="keywordtype">void</span> <a id="a20" name="a20"></a><a class="code hl_function" href="main_8cpp.html#ac479d4c5bd7115dad8327179d2807292">mostrarEstadoCola</a>();                     </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumeration" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9">LogLevel</a> level, <span class="keyword">const</span> String &amp;message); </div>
<div class="line"><span class="keywordtype">void</span> <a id="a21" name="a21"></a><a class="code hl_function" href="main_8cpp.html#a9a93e8a67389dba86e41c078dc312eb7">inicializarSistema</a>();                    </div>
<div class="line"><span class="keywordtype">void</span> <a id="a22" name="a22"></a><a class="code hl_function" href="main_8cpp.html#a20c47db1814149244be00a806452f62a">verificarRecursosSistema</a>();              </div>
<div class="line"> </div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"><span class="comment">// SISTEMA DE LOGGING</span></div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumeration" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9">LogLevel</a> level, <span class="keyword">const</span> String &amp;message) {</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* levels[] = {</div>
<div class="line">        <span class="stringliteral">&quot;DEBUG&quot;</span>, <span class="stringliteral">&quot;INFO&quot;</span>, <span class="stringliteral">&quot;WARNING&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;ERROR&quot;</span></div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> show = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a id="a23" name="a23"></a><a class="code hl_define" href="main_8cpp.html#ac80a3592e72fd96b772ee47a7d8e0d0a">DEBUG_MODE</a>) {</div>
<div class="line">        show = <span class="keyword">true</span>; <span class="comment">// modo completo - todos los niveles</span></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// Filtra solo niveles esenciales para producción</span></div>
<div class="line">        <span class="keywordflow">switch</span> (level) {</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>:</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a984de77c680eaff141ec910e25568a81">WARNING</a>:</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a2fd6f336d08340583bd620a7f5694c90">ERROR</a>:</div>
<div class="line">                show = <span class="keyword">true</span>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">                show = <span class="keyword">false</span>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (show) {</div>
<div class="line">        Serial.printf(<span class="stringliteral">&quot;[%s] %s\n&quot;</span>, levels[level], message.c_str());</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"><span class="comment">// FUNCIONES AUXILIARES</span></div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="main_8cpp.html#ac479d4c5bd7115dad8327179d2807292">mostrarEstadoCola</a>() {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="main_8cpp.html#aa790f7161e459ab25c4a12b7385b4d15">xColaDatos</a> != NULL) {</div>
<div class="line">        UBaseType_t espaciosLibres = uxQueueSpacesAvailable(<a class="code hl_variable" href="main_8cpp.html#aa790f7161e459ab25c4a12b7385b4d15">xColaDatos</a>);</div>
<div class="line">        UBaseType_t mensajesEnCola = uxQueueMessagesWaiting(<a class="code hl_variable" href="main_8cpp.html#aa790f7161e459ab25c4a12b7385b4d15">xColaDatos</a>);</div>
<div class="line">        UBaseType_t tamanoTotal = uxQueueSpacesAvailable(<a class="code hl_variable" href="main_8cpp.html#aa790f7161e459ab25c4a12b7385b4d15">xColaDatos</a>) + uxQueueMessagesWaiting(<a class="code hl_variable" href="main_8cpp.html#aa790f7161e459ab25c4a12b7385b4d15">xColaDatos</a>);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_define" href="main_8cpp.html#ac80a3592e72fd96b772ee47a7d8e0d0a">DEBUG_MODE</a>) {</div>
<div class="line">            Serial.printf(<span class="stringliteral">&quot;[ESTADO COLA] Mensajes: %d, Espacios libres: %d, Tamaño total: %d\n&quot;</span>, </div>
<div class="line">                         mensajesEnCola, espaciosLibres, tamanoTotal);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Log del estado (siempre visible en modo producción)</span></div>
<div class="line">        String estado = <span class="stringliteral">&quot;Cola: &quot;</span> + String(mensajesEnCola) + <span class="stringliteral">&quot;/&quot;</span> + String(tamanoTotal) + </div>
<div class="line">                       <span class="stringliteral">&quot; mensajes (&quot;</span> + String(espaciosLibres) + <span class="stringliteral">&quot; libres)&quot;</span>;</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, estado);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;Cola no inicializada&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="main_8cpp.html#a20c47db1814149244be00a806452f62a">verificarRecursosSistema</a>() {</div>
<div class="line">    <span class="keywordtype">bool</span> sistemaOK = <span class="keyword">true</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="main_8cpp.html#a89b891091e9e003d0eab8f6a4ced7dcf">xMutex</a> == NULL) {</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;Fallo creación mutex&quot;</span>);</div>
<div class="line">        sistemaOK = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="main_8cpp.html#a6f655f04d910fcd6e502bb161804986a">xSemaphoreEnvio</a> == NULL) {</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;Fallo creación semáforo envío&quot;</span>);</div>
<div class="line">        sistemaOK = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="main_8cpp.html#aa790f7161e459ab25c4a12b7385b4d15">xColaDatos</a> == NULL) {</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;Fallo creación cola datos&quot;</span>);</div>
<div class="line">        sistemaOK = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (sistemaOK) {</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Todos los recursos FreeRTOS inicializados correctamente&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;Error crítico en inicialización de recursos - sistema puede no funcionar&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="main_8cpp.html#a9a93e8a67389dba86e41c078dc312eb7">inicializarSistema</a>() {</div>
<div class="line">    Serial.begin(115200);</div>
<div class="line">    delay(1000); <span class="comment">// Espera para estabilización</span></div>
<div class="line">    </div>
<div class="line">    Serial.println(<span class="stringliteral">&quot;=== SISTEMA FreeRTOS CON COLA DE MENSAJES ===&quot;</span>);</div>
<div class="line">    Serial.println(<span class="stringliteral">&quot;Autor: Tu Nombre&quot;</span>);</div>
<div class="line">    Serial.println(<span class="stringliteral">&quot;Versión: 1.0&quot;</span>);</div>
<div class="line">    Serial.println(<span class="stringliteral">&quot;Modo: &quot;</span> + String(<a class="code hl_define" href="main_8cpp.html#ac80a3592e72fd96b772ee47a7d8e0d0a">DEBUG_MODE</a> ? <span class="stringliteral">&quot;DEBUG&quot;</span> : <span class="stringliteral">&quot;PRODUCCIÓN&quot;</span>));</div>
<div class="line">    Serial.println(<span class="stringliteral">&quot;=============================================&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Inicializando sistema...&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"><span class="comment">// CONFIGURACIÓN PRINCIPAL (SETUP)</span></div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a id="a24" name="a24"></a><a class="code hl_function" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a>() {</div>
<div class="line">    <a class="code hl_function" href="main_8cpp.html#a9a93e8a67389dba86e41c078dc312eb7">inicializarSistema</a>();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Crear recursos de sincronización FreeRTOS</span></div>
<div class="line">    <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Creando recursos de sincronización...&quot;</span>);</div>
<div class="line">    <a class="code hl_variable" href="main_8cpp.html#a89b891091e9e003d0eab8f6a4ced7dcf">xMutex</a> = xSemaphoreCreateMutex();</div>
<div class="line">    <a class="code hl_variable" href="main_8cpp.html#a6f655f04d910fcd6e502bb161804986a">xSemaphoreEnvio</a> = xSemaphoreCreateBinary();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Crear cola de mensajes</span></div>
<div class="line">    <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Creando cola de mensajes con tamaño: &quot;</span> + String(<a id="a25" name="a25"></a><a class="code hl_define" href="main_8cpp.html#a76f3097639532ffcbf354c4d735fd539">COLA_TAMANO</a>));</div>
<div class="line">    <a class="code hl_variable" href="main_8cpp.html#aa790f7161e459ab25c4a12b7385b4d15">xColaDatos</a> = xQueueCreate(<a class="code hl_define" href="main_8cpp.html#a76f3097639532ffcbf354c4d735fd539">COLA_TAMANO</a>, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structDatosSensor.html">DatosSensor</a>));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Verificar que todos los recursos se crearon correctamente</span></div>
<div class="line">    <a class="code hl_function" href="main_8cpp.html#a20c47db1814149244be00a806452f62a">verificarRecursosSistema</a>();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="main_8cpp.html#aa790f7161e459ab25c4a12b7385b4d15">xColaDatos</a> != NULL) {</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Cola creada exitosamente - Capacidad: &quot;</span> + String(<a class="code hl_define" href="main_8cpp.html#a76f3097639532ffcbf354c4d735fd539">COLA_TAMANO</a>) + <span class="stringliteral">&quot; elementos&quot;</span>);</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#ac479d4c5bd7115dad8327179d2807292">mostrarEstadoCola</a>(); <span class="comment">// Estado inicial</span></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Crear tareas del sistema</span></div>
<div class="line">    <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Creando tareas FreeRTOS...&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    xTaskCreate(<a class="code hl_function" href="main_8cpp.html#af7236328716099c5a8377996b87ffd0d">TaskTemperatura</a>, <span class="stringliteral">&quot;LecturaTemp&quot;</span>, 2048, NULL, 2, NULL);</div>
<div class="line">    </div>
<div class="line">    xTaskCreate(<a class="code hl_function" href="main_8cpp.html#a951d8aa1e4fad228585e8cc12e93d85f">TaskHumedad</a>, <span class="stringliteral">&quot;LecturaHum&quot;</span>, 2048, NULL, 2, NULL);</div>
<div class="line">    </div>
<div class="line">    xTaskCreate(<a class="code hl_function" href="main_8cpp.html#a0a20810e0b755938a26f4bdb9c73a01e">TaskEnviar</a>, <span class="stringliteral">&quot;EnvioDatos&quot;</span>, 2048, NULL, 1, NULL);</div>
<div class="line">    </div>
<div class="line">    xTaskCreate(<a class="code hl_function" href="main_8cpp.html#af48162eef8344edea5030479f116635f">TaskProcesarCola</a>, <span class="stringliteral">&quot;ProcesarCola&quot;</span>, 2048, NULL, 1, NULL);</div>
<div class="line">    </div>
<div class="line">    <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Sistema inicializado - Todas las tareas creadas&quot;</span>);</div>
<div class="line">    <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Tareas en ejecución: LecturaTemp(2s), LecturaHum(3s), ProcesarCola(4s)&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a id="a26" name="a26"></a><a class="code hl_function" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f">loop</a>() {</div>
<div class="line">    <span class="comment">// El loop queda vacío. FreeRTOS se encarga de la ejecución de tareas.</span></div>
<div class="line">    <span class="comment">// Podemos agregar aquí monitoreo del sistema si es necesario</span></div>
<div class="line">    vTaskDelay(pdMS_TO_TICKS(10000)); <span class="comment">// Pequeña pausa para evitar uso excesivo de CPU</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"><span class="comment">// IMPLEMENTACIÓN DE TAREAS</span></div>
<div class="line"><span class="comment">// =============================================================================</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="main_8cpp.html#af7236328716099c5a8377996b87ffd0d">TaskTemperatura</a>(<span class="keywordtype">void</span> *pvParameters) {</div>
<div class="line">    <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Tarea de temperatura iniciada - Periodo: &quot;</span> + String(<a id="a27" name="a27"></a><a class="code hl_define" href="main_8cpp.html#a9ed7f1bdc006abb70a225d64930f3a36">TIEMPO_MUESTREO_TEMP</a>) + <span class="stringliteral">&quot;ms&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">        <span class="comment">// Tomar el mutex para acceso seguro a variables compartidas</span></div>
<div class="line">        xSemaphoreTake(<a class="code hl_variable" href="main_8cpp.html#a89b891091e9e003d0eab8f6a4ced7dcf">xMutex</a>, portMAX_DELAY);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Simular lectura de sensor de temperatura</span></div>
<div class="line">        <a class="code hl_variable" href="main_8cpp.html#aa68e0fc8577f270a5009b9eaf46d14d0">temperatura</a> = 24.0 + random(-30, 30) / 10.0;</div>
<div class="line">        <a class="code hl_variable" href="main_8cpp.html#a2c7fe780b692c078c449752cb090fc6e">temp_actualizada</a> = <span class="keyword">true</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_define" href="main_8cpp.html#ac80a3592e72fd96b772ee47a7d8e0d0a">DEBUG_MODE</a>) {</div>
<div class="line">            Serial.printf(<span class="stringliteral">&quot;[TareaTemp] Temperatura: %.1f °C\n&quot;</span>, <a class="code hl_variable" href="main_8cpp.html#aa68e0fc8577f270a5009b9eaf46d14d0">temperatura</a>);</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Temperatura: &quot;</span> + String(<a class="code hl_variable" href="main_8cpp.html#aa68e0fc8577f270a5009b9eaf46d14d0">temperatura</a>, 1) + <span class="stringliteral">&quot; °C&quot;</span>);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Verificar si podemos enviar (ambos sensores actualizados)</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_variable" href="main_8cpp.html#a2c7fe780b692c078c449752cb090fc6e">temp_actualizada</a> &amp;&amp; <a class="code hl_variable" href="main_8cpp.html#a50d54178b84b42fb8a9ab1e0acaa8cac">hum_actualizada</a>) {</div>
<div class="line">            xSemaphoreGive(<a class="code hl_variable" href="main_8cpp.html#a6f655f04d910fcd6e502bb161804986a">xSemaphoreEnvio</a>);</div>
<div class="line">            <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a0593585da9181e972974c1274d8f2b4f">DEBUG</a>, <span class="stringliteral">&quot;Semáforo de envío activado - ambos sensores listos&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Liberar el mutex</span></div>
<div class="line">        xSemaphoreGive(<a class="code hl_variable" href="main_8cpp.html#a89b891091e9e003d0eab8f6a4ced7dcf">xMutex</a>);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Esperar hasta próxima lectura</span></div>
<div class="line">        vTaskDelay(pdMS_TO_TICKS(<a class="code hl_define" href="main_8cpp.html#a9ed7f1bdc006abb70a225d64930f3a36">TIEMPO_MUESTREO_TEMP</a>));</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="main_8cpp.html#a951d8aa1e4fad228585e8cc12e93d85f">TaskHumedad</a>(<span class="keywordtype">void</span> *pvParameters) {</div>
<div class="line">    <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Tarea de humedad iniciada - Periodo: &quot;</span> + String(<a id="a28" name="a28"></a><a class="code hl_define" href="main_8cpp.html#a1701a9c95bcfabe90644b6bdfc53b91d">TIEMPO_MUESTREO_HUM</a>) + <span class="stringliteral">&quot;ms&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">        <span class="comment">// Tomar el mutex para acceso seguro a variables compartidas</span></div>
<div class="line">        xSemaphoreTake(<a class="code hl_variable" href="main_8cpp.html#a89b891091e9e003d0eab8f6a4ced7dcf">xMutex</a>, portMAX_DELAY);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Simular lectura de sensor de humedad</span></div>
<div class="line">        <a class="code hl_variable" href="main_8cpp.html#ab394a2325331757de6eae71b16c435e9">humedad</a> = 60.0 + random(-20, 20) / 10.0;</div>
<div class="line">        <a class="code hl_variable" href="main_8cpp.html#a50d54178b84b42fb8a9ab1e0acaa8cac">hum_actualizada</a> = <span class="keyword">true</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_define" href="main_8cpp.html#ac80a3592e72fd96b772ee47a7d8e0d0a">DEBUG_MODE</a>) {</div>
<div class="line">            Serial.printf(<span class="stringliteral">&quot;[TareaHum] Humedad: %.1f %%\n&quot;</span>, <a class="code hl_variable" href="main_8cpp.html#ab394a2325331757de6eae71b16c435e9">humedad</a>);</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Humedad: &quot;</span> + String(<a class="code hl_variable" href="main_8cpp.html#ab394a2325331757de6eae71b16c435e9">humedad</a>, 1) + <span class="stringliteral">&quot; %&quot;</span>);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Verificar si podemos enviar (ambos sensores actualizados)</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_variable" href="main_8cpp.html#a2c7fe780b692c078c449752cb090fc6e">temp_actualizada</a> &amp;&amp; <a class="code hl_variable" href="main_8cpp.html#a50d54178b84b42fb8a9ab1e0acaa8cac">hum_actualizada</a>) {</div>
<div class="line">            xSemaphoreGive(<a class="code hl_variable" href="main_8cpp.html#a6f655f04d910fcd6e502bb161804986a">xSemaphoreEnvio</a>);</div>
<div class="line">            <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a0593585da9181e972974c1274d8f2b4f">DEBUG</a>, <span class="stringliteral">&quot;Semáforo de envío activado - ambos sensores listos&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Liberar el mutex</span></div>
<div class="line">        xSemaphoreGive(<a class="code hl_variable" href="main_8cpp.html#a89b891091e9e003d0eab8f6a4ced7dcf">xMutex</a>);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Esperar hasta próxima lectura</span></div>
<div class="line">        vTaskDelay(pdMS_TO_TICKS(<a class="code hl_define" href="main_8cpp.html#a1701a9c95bcfabe90644b6bdfc53b91d">TIEMPO_MUESTREO_HUM</a>));</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="main_8cpp.html#a0a20810e0b755938a26f4bdb9c73a01e">TaskEnviar</a>(<span class="keywordtype">void</span> *pvParameters) {</div>
<div class="line">    <a class="code hl_struct" href="structDatosSensor.html">DatosSensor</a> datos;</div>
<div class="line">    <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Tarea de envío a cola iniciada&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">        <span class="comment">// Esperar a que ambos valores estén actualizados</span></div>
<div class="line">        xSemaphoreTake(<a class="code hl_variable" href="main_8cpp.html#a6f655f04d910fcd6e502bb161804986a">xSemaphoreEnvio</a>, portMAX_DELAY);</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a0593585da9181e972974c1274d8f2b4f">DEBUG</a>, <span class="stringliteral">&quot;Semáforo de envío recibido - preparando datos para cola&quot;</span>);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Tomar el mutex para acceder a las variables compartidas</span></div>
<div class="line">        xSemaphoreTake(<a class="code hl_variable" href="main_8cpp.html#a89b891091e9e003d0eab8f6a4ced7dcf">xMutex</a>, portMAX_DELAY);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Preparar datos para la cola</span></div>
<div class="line">        datos.<a class="code hl_variable" href="structDatosSensor.html#a611f4f290b184e14b1b3ca076734ed35">temp</a> = <a class="code hl_variable" href="main_8cpp.html#aa68e0fc8577f270a5009b9eaf46d14d0">temperatura</a>;</div>
<div class="line">        datos.<a class="code hl_variable" href="structDatosSensor.html#a8d083dbc43e4b9a357f7fdd254942578">hum</a> = <a class="code hl_variable" href="main_8cpp.html#ab394a2325331757de6eae71b16c435e9">humedad</a>;</div>
<div class="line">        datos.<a class="code hl_variable" href="structDatosSensor.html#aa4c9ab56e967437b601d0f64a6091cc0">timestamp</a> = millis();</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Enviar datos a la cola (NO BLOQUEANTE - timeout 0)</span></div>
<div class="line">        <span class="keywordflow">if</span> (xQueueSend(<a class="code hl_variable" href="main_8cpp.html#aa790f7161e459ab25c4a12b7385b4d15">xColaDatos</a>, &amp;datos, 0) == pdTRUE) {</div>
<div class="line">            <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Datos enviados a cola: &quot;</span> + String(<a class="code hl_variable" href="main_8cpp.html#aa68e0fc8577f270a5009b9eaf46d14d0">temperatura</a>, 1) + </div>
<div class="line">                <span class="stringliteral">&quot;°C / &quot;</span> + String(<a class="code hl_variable" href="main_8cpp.html#ab394a2325331757de6eae71b16c435e9">humedad</a>, 1) + <span class="stringliteral">&quot;%&quot;</span>);</div>
<div class="line">                </div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_define" href="main_8cpp.html#ac80a3592e72fd96b772ee47a7d8e0d0a">DEBUG_MODE</a>) {</div>
<div class="line">                Serial.printf(<span class="stringliteral">&quot;[TareaEnvio] Datos enviados a la cola -&gt; %.1f °C / %.1f %%\n&quot;</span>, </div>
<div class="line">                            <a class="code hl_variable" href="main_8cpp.html#aa68e0fc8577f270a5009b9eaf46d14d0">temperatura</a>, <a class="code hl_variable" href="main_8cpp.html#ab394a2325331757de6eae71b16c435e9">humedad</a>);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a2fd6f336d08340583bd620a7f5694c90">ERROR</a>, <span class="stringliteral">&quot;Cola llena - no se pudo enviar datos: &quot;</span> + </div>
<div class="line">                String(<a class="code hl_variable" href="main_8cpp.html#aa68e0fc8577f270a5009b9eaf46d14d0">temperatura</a>, 1) + <span class="stringliteral">&quot;°C / &quot;</span> + String(<a class="code hl_variable" href="main_8cpp.html#ab394a2325331757de6eae71b16c435e9">humedad</a>, 1) + <span class="stringliteral">&quot;%&quot;</span>);</div>
<div class="line">                </div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_define" href="main_8cpp.html#ac80a3592e72fd96b772ee47a7d8e0d0a">DEBUG_MODE</a>) {</div>
<div class="line">                Serial.println(<span class="stringliteral">&quot;[TareaEnvio] ERROR: Cola llena, no se pudo enviar&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Resetear flags después del envío (exitoso o no)</span></div>
<div class="line">        <a class="code hl_variable" href="main_8cpp.html#a2c7fe780b692c078c449752cb090fc6e">temp_actualizada</a> = <span class="keyword">false</span>;</div>
<div class="line">        <a class="code hl_variable" href="main_8cpp.html#a50d54178b84b42fb8a9ab1e0acaa8cac">hum_actualizada</a> = <span class="keyword">false</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Liberar el mutex</span></div>
<div class="line">        xSemaphoreGive(<a class="code hl_variable" href="main_8cpp.html#a89b891091e9e003d0eab8f6a4ced7dcf">xMutex</a>);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Pequeña pausa para simular procesamiento adicional</span></div>
<div class="line">        vTaskDelay(pdMS_TO_TICKS(100));</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="main_8cpp.html#af48162eef8344edea5030479f116635f">TaskProcesarCola</a>(<span class="keywordtype">void</span> *pvParameters) {</div>
<div class="line">    <a class="code hl_struct" href="structDatosSensor.html">DatosSensor</a> datosRecibidos;</div>
<div class="line">    <span class="keywordtype">int</span> contador = 0;</div>
<div class="line">    </div>
<div class="line">    <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Tarea de procesamiento de cola iniciada - Tiempo procesamiento: &quot;</span> + </div>
<div class="line">               String(<a id="a29" name="a29"></a><a class="code hl_define" href="main_8cpp.html#a159f5f40f02a301f9de14f95d133b5a7">TIEMPO_PROCESAMIENTO_COLA</a>) + <span class="stringliteral">&quot;ms&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">        <span class="comment">// Esperar por datos en la cola (BLOQUEANTE - se activa cuando hay datos)</span></div>
<div class="line">        <span class="keywordflow">if</span> (xQueueReceive(<a class="code hl_variable" href="main_8cpp.html#aa790f7161e459ab25c4a12b7385b4d15">xColaDatos</a>, &amp;datosRecibidos, portMAX_DELAY) == pdTRUE) {</div>
<div class="line">            contador++;</div>
<div class="line">            </div>
<div class="line">            <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Procesando datos #&quot;</span> + String(contador) + <span class="stringliteral">&quot;: &quot;</span> + </div>
<div class="line">                String(datosRecibidos.<a class="code hl_variable" href="structDatosSensor.html#a611f4f290b184e14b1b3ca076734ed35">temp</a>, 1) + <span class="stringliteral">&quot;°C / &quot;</span> + </div>
<div class="line">                String(datosRecibidos.<a class="code hl_variable" href="structDatosSensor.html#a8d083dbc43e4b9a357f7fdd254942578">hum</a>, 1) + <span class="stringliteral">&quot;%&quot;</span> +</div>
<div class="line">                <span class="stringliteral">&quot; [TS: &quot;</span> + String(datosRecibidos.<a class="code hl_variable" href="structDatosSensor.html#aa4c9ab56e967437b601d0f64a6091cc0">timestamp</a>) + <span class="stringliteral">&quot;ms]&quot;</span>);</div>
<div class="line">                </div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_define" href="main_8cpp.html#ac80a3592e72fd96b772ee47a7d8e0d0a">DEBUG_MODE</a>) {</div>
<div class="line">                Serial.printf(<span class="stringliteral">&quot;[ProcesarCola] Datos recibidos: %.1f°C / %.1f%% (TS: %lu ms)\n&quot;</span>, </div>
<div class="line">                             datosRecibidos.<a class="code hl_variable" href="structDatosSensor.html#a611f4f290b184e14b1b3ca076734ed35">temp</a>, datosRecibidos.<a class="code hl_variable" href="structDatosSensor.html#a8d083dbc43e4b9a357f7fdd254942578">hum</a>, datosRecibidos.<a class="code hl_variable" href="structDatosSensor.html#aa4c9ab56e967437b601d0f64a6091cc0">timestamp</a>);</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// Mostrar estado cada 3 recepciones</span></div>
<div class="line">            <span class="keywordflow">if</span> (contador % 3 == 0) {</div>
<div class="line">                <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Procesados &quot;</span> + String(contador) + <span class="stringliteral">&quot; paquetes de datos&quot;</span>);</div>
<div class="line">                <a class="code hl_function" href="main_8cpp.html#ac479d4c5bd7115dad8327179d2807292">mostrarEstadoCola</a>();</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// SIMULAR PROCESAMIENTO LENTO - Hacer esta tarea más lenta para llenar la cola</span></div>
<div class="line">            <span class="comment">// En sistema real, aquí iría: almacenamiento, transmisión, cálculos, etc.</span></div>
<div class="line">            <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Iniciando procesamiento de &quot;</span> + String(<a class="code hl_define" href="main_8cpp.html#a159f5f40f02a301f9de14f95d133b5a7">TIEMPO_PROCESAMIENTO_COLA</a>) + <span class="stringliteral">&quot;ms&quot;</span>);</div>
<div class="line">            vTaskDelay(pdMS_TO_TICKS(<a class="code hl_define" href="main_8cpp.html#a159f5f40f02a301f9de14f95d133b5a7">TIEMPO_PROCESAMIENTO_COLA</a>));</div>
<div class="line">            <a class="code hl_function" href="main_8cpp.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806">INFO</a>, <span class="stringliteral">&quot;Procesamiento completado&quot;</span>);</div>
<div class="line">            </div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="amain_8cpp_html_a0a20810e0b755938a26f4bdb9c73a01e"><div class="ttname"><a href="main_8cpp.html#a0a20810e0b755938a26f4bdb9c73a01e">TaskEnviar</a></div><div class="ttdeci">void TaskEnviar(void *pvParameters)</div><div class="ttdoc">Tarea de envío a cola.</div><div class="ttdef"><b>Definition</b> main.cpp:492</div></div>
<div class="ttc" id="amain_8cpp_html_a159f5f40f02a301f9de14f95d133b5a7"><div class="ttname"><a href="main_8cpp.html#a159f5f40f02a301f9de14f95d133b5a7">TIEMPO_PROCESAMIENTO_COLA</a></div><div class="ttdeci">#define TIEMPO_PROCESAMIENTO_COLA</div><div class="ttdoc">Tiempo de procesamiento simulado para datos de la cola.</div><div class="ttdef"><b>Definition</b> main.cpp:74</div></div>
<div class="ttc" id="amain_8cpp_html_a1701a9c95bcfabe90644b6bdfc53b91d"><div class="ttname"><a href="main_8cpp.html#a1701a9c95bcfabe90644b6bdfc53b91d">TIEMPO_MUESTREO_HUM</a></div><div class="ttdeci">#define TIEMPO_MUESTREO_HUM</div><div class="ttdoc">Periodo de muestreo para humedad en milisegundos</div><div class="ttdef"><b>Definition</b> main.cpp:68</div></div>
<div class="ttc" id="amain_8cpp_html_a20c47db1814149244be00a806452f62a"><div class="ttname"><a href="main_8cpp.html#a20c47db1814149244be00a806452f62a">verificarRecursosSistema</a></div><div class="ttdeci">void verificarRecursosSistema()</div><div class="ttdoc">Verificación de recursos FreeRTOS.</div><div class="ttdef"><b>Definition</b> main.cpp:264</div></div>
<div class="ttc" id="amain_8cpp_html_a2c7fe780b692c078c449752cb090fc6e"><div class="ttname"><a href="main_8cpp.html#a2c7fe780b692c078c449752cb090fc6e">temp_actualizada</a></div><div class="ttdeci">bool temp_actualizada</div><div class="ttdoc">Flag que indica si la temperatura ha sido actualizada.</div><div class="ttdef"><b>Definition</b> main.cpp:126</div></div>
<div class="ttc" id="amain_8cpp_html_a4fc01d736fe50cf5b977f755b675f11d"><div class="ttname"><a href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a></div><div class="ttdeci">void setup()</div><div class="ttdoc">Función de configuración inicial del sistema Arduino.</div><div class="ttdef"><b>Definition</b> main.cpp:321</div></div>
<div class="ttc" id="amain_8cpp_html_a50d54178b84b42fb8a9ab1e0acaa8cac"><div class="ttname"><a href="main_8cpp.html#a50d54178b84b42fb8a9ab1e0acaa8cac">hum_actualizada</a></div><div class="ttdeci">bool hum_actualizada</div><div class="ttdoc">Flag que indica si la humedad ha sido actualizada.</div><div class="ttdef"><b>Definition</b> main.cpp:133</div></div>
<div class="ttc" id="amain_8cpp_html_a6f655f04d910fcd6e502bb161804986a"><div class="ttname"><a href="main_8cpp.html#a6f655f04d910fcd6e502bb161804986a">xSemaphoreEnvio</a></div><div class="ttdeci">SemaphoreHandle_t xSemaphoreEnvio</div><div class="ttdoc">Semáforo binario para sincronización de envío de datos.</div><div class="ttdef"><b>Definition</b> main.cpp:151</div></div>
<div class="ttc" id="amain_8cpp_html_a76f3097639532ffcbf354c4d735fd539"><div class="ttname"><a href="main_8cpp.html#a76f3097639532ffcbf354c4d735fd539">COLA_TAMANO</a></div><div class="ttdeci">#define COLA_TAMANO</div><div class="ttdoc">Tamaño máximo de la cola de mensajes.</div><div class="ttdef"><b>Definition</b> main.cpp:56</div></div>
<div class="ttc" id="amain_8cpp_html_a89b891091e9e003d0eab8f6a4ced7dcf"><div class="ttname"><a href="main_8cpp.html#a89b891091e9e003d0eab8f6a4ced7dcf">xMutex</a></div><div class="ttdeci">SemaphoreHandle_t xMutex</div><div class="ttdoc">Mutex para protección de variables compartidas.</div><div class="ttdef"><b>Definition</b> main.cpp:144</div></div>
<div class="ttc" id="amain_8cpp_html_a951d8aa1e4fad228585e8cc12e93d85f"><div class="ttname"><a href="main_8cpp.html#a951d8aa1e4fad228585e8cc12e93d85f">TaskHumedad</a></div><div class="ttdeci">void TaskHumedad(void *pvParameters)</div><div class="ttdoc">Tarea de lectura de humedad</div><div class="ttdef"><b>Definition</b> main.cpp:449</div></div>
<div class="ttc" id="amain_8cpp_html_a9a93e8a67389dba86e41c078dc312eb7"><div class="ttname"><a href="main_8cpp.html#a9a93e8a67389dba86e41c078dc312eb7">inicializarSistema</a></div><div class="ttdeci">void inicializarSistema()</div><div class="ttdoc">Inicialización del sistema.</div><div class="ttdef"><b>Definition</b> main.cpp:293</div></div>
<div class="ttc" id="amain_8cpp_html_a9ed7f1bdc006abb70a225d64930f3a36"><div class="ttname"><a href="main_8cpp.html#a9ed7f1bdc006abb70a225d64930f3a36">TIEMPO_MUESTREO_TEMP</a></div><div class="ttdeci">#define TIEMPO_MUESTREO_TEMP</div><div class="ttdoc">Periodo de muestreo para temperatura en milisegundos.</div><div class="ttdef"><b>Definition</b> main.cpp:62</div></div>
<div class="ttc" id="amain_8cpp_html_aa68e0fc8577f270a5009b9eaf46d14d0"><div class="ttname"><a href="main_8cpp.html#aa68e0fc8577f270a5009b9eaf46d14d0">temperatura</a></div><div class="ttdeci">float temperatura</div><div class="ttdoc">Último valor de temperatura leído.</div><div class="ttdef"><b>Definition</b> main.cpp:112</div></div>
<div class="ttc" id="amain_8cpp_html_aa790f7161e459ab25c4a12b7385b4d15"><div class="ttname"><a href="main_8cpp.html#aa790f7161e459ab25c4a12b7385b4d15">xColaDatos</a></div><div class="ttdeci">QueueHandle_t xColaDatos</div><div class="ttdoc">Cola de mensajes para comunicación entre tareas de producción y consumo.</div><div class="ttdef"><b>Definition</b> main.cpp:158</div></div>
<div class="ttc" id="amain_8cpp_html_ab394a2325331757de6eae71b16c435e9"><div class="ttname"><a href="main_8cpp.html#ab394a2325331757de6eae71b16c435e9">humedad</a></div><div class="ttdeci">float humedad</div><div class="ttdoc">Último valor de humedad leído.</div><div class="ttdef"><b>Definition</b> main.cpp:119</div></div>
<div class="ttc" id="amain_8cpp_html_ac479d4c5bd7115dad8327179d2807292"><div class="ttname"><a href="main_8cpp.html#ac479d4c5bd7115dad8327179d2807292">mostrarEstadoCola</a></div><div class="ttdeci">void mostrarEstadoCola()</div><div class="ttdoc">Muestra estado de la cola.</div><div class="ttdef"><b>Definition</b> main.cpp:238</div></div>
<div class="ttc" id="amain_8cpp_html_ac80a3592e72fd96b772ee47a7d8e0d0a"><div class="ttname"><a href="main_8cpp.html#ac80a3592e72fd96b772ee47a7d8e0d0a">DEBUG_MODE</a></div><div class="ttdeci">#define DEBUG_MODE</div><div class="ttdoc">Habilita logs detallados de depuración cuando es true.</div><div class="ttdef"><b>Definition</b> main.cpp:49</div></div>
<div class="ttc" id="amain_8cpp_html_aca1fd1d8935433e6ba2e3918214e07f9"><div class="ttname"><a href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9">LogLevel</a></div><div class="ttdeci">LogLevel</div><div class="ttdoc">Niveles de logging disponibles para el sistema.</div><div class="ttdef"><b>Definition</b> main.cpp:85</div></div>
<div class="ttc" id="amain_8cpp_html_aca1fd1d8935433e6ba2e3918214e07f9a2fd6f336d08340583bd620a7f5694c90"><div class="ttname"><a href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a2fd6f336d08340583bd620a7f5694c90">ERROR</a></div><div class="ttdeci">@ ERROR</div><div class="ttdoc">Errores del sistema.</div><div class="ttdef"><b>Definition</b> main.cpp:89</div></div>
<div class="ttc" id="amain_8cpp_html_aca1fd1d8935433e6ba2e3918214e07f9a984de77c680eaff141ec910e25568a81"><div class="ttname"><a href="main_8cpp.html#aca1fd1d8935433e6ba2e3918214e07f9a984de77c680eaff141ec910e25568a81">WARNING</a></div><div class="ttdeci">@ WARNING</div><div class="ttdoc">Advertencias no críticas.</div><div class="ttdef"><b>Definition</b> main.cpp:88</div></div>
<div class="ttc" id="amain_8cpp_html_af48162eef8344edea5030479f116635f"><div class="ttname"><a href="main_8cpp.html#af48162eef8344edea5030479f116635f">TaskProcesarCola</a></div><div class="ttdeci">void TaskProcesarCola(void *pvParameters)</div><div class="ttdoc">Tarea de consumo de cola.</div><div class="ttdef"><b>Definition</b> main.cpp:551</div></div>
<div class="ttc" id="amain_8cpp_html_af7236328716099c5a8377996b87ffd0d"><div class="ttname"><a href="main_8cpp.html#af7236328716099c5a8377996b87ffd0d">TaskTemperatura</a></div><div class="ttdeci">void TaskTemperatura(void *pvParameters)</div><div class="ttdoc">Tarea de lectura de temperatura.</div><div class="ttdef"><b>Definition</b> main.cpp:407</div></div>
<div class="ttc" id="amain_8cpp_html_afe461d27b9c48d5921c00d521181f12f"><div class="ttname"><a href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f">loop</a></div><div class="ttdeci">void loop()</div><div class="ttdoc">Bucle principal (vacío)</div><div class="ttdef"><b>Definition</b> main.cpp:385</div></div>
<div class="ttc" id="astructDatosSensor_html"><div class="ttname"><a href="structDatosSensor.html">DatosSensor</a></div><div class="ttdoc">Estructura para almacenamiento y transmisión de datos de sensores.</div><div class="ttdef"><b>Definition</b> main.cpp:97</div></div>
<div class="ttc" id="astructDatosSensor_html_a611f4f290b184e14b1b3ca076734ed35"><div class="ttname"><a href="structDatosSensor.html#a611f4f290b184e14b1b3ca076734ed35">DatosSensor::temp</a></div><div class="ttdeci">float temp</div><div class="ttdoc">Temperatura en grados Celsius.</div><div class="ttdef"><b>Definition</b> main.cpp:98</div></div>
<div class="ttc" id="astructDatosSensor_html_a8d083dbc43e4b9a357f7fdd254942578"><div class="ttname"><a href="structDatosSensor.html#a8d083dbc43e4b9a357f7fdd254942578">DatosSensor::hum</a></div><div class="ttdeci">float hum</div><div class="ttdoc">Humedad relativa en porcentaje.</div><div class="ttdef"><b>Definition</b> main.cpp:99</div></div>
<div class="ttc" id="astructDatosSensor_html_aa4c9ab56e967437b601d0f64a6091cc0"><div class="ttname"><a href="structDatosSensor.html#aa4c9ab56e967437b601d0f64a6091cc0">DatosSensor::timestamp</a></div><div class="ttdeci">unsigned long timestamp</div><div class="ttdoc">Marca de tiempo de la medición (ms desde inicio)</div><div class="ttdef"><b>Definition</b> main.cpp:100</div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
